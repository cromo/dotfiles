#!/usr/bin/env bash
set -euo pipefail

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$script_dir"
dotfiles_root="$(git rev-parse --show-toplevel)"
cd "$dotfiles_root"

export PATH="$dotfiles_root/bin:$PATH"

main() {
  if janus_installed; then
    echo "Janus install detected."
    if file_or_link_exists "$HOME/.vimrc.after"; then
      echo "Backing up existing .vimrc.after to .vimrc.after.old"
      mv "$HOME/.vimrc.after"{,.old}
    fi
    ln -s "$dotfiles_root/vimrc.after" "$HOME/.vimrc.after"
    echo ".vimrc.after linked."
  else
    echo "Janus not detected. This code path is not implemented."
    echo "No changes were made."
    return 1
  fi
}

file_or_link_exists() {
  [[ -e "$1" || -L "$1" ]]
}

main
